/**
  ******************************************************************************
  * @file    main.c
  * @author  Auto-generated by STM32CubeIDE
  * @version V1.0
  * @brief   Default main function.
  ******************************************************************************
*/
#include "stm32f767xx.h"

#include "util.h"
#include "GPIO_driver.h"
#include "EXTI_driver.h"

#define LED_PORT 	GPIOB

#define BUTTON_PORT	GPIOC

#define TOUCH_SENSOR_PORT	GPIOG

typedef enum{
	LED_1_PIN = 0,
	LED_2_PIN = 7,
	LED_3_PIN = 14
}led_pin_number_e;

#define BUTTON_PIN	13

#define TOUCH_SENSOR_PIN	0

static void initLED(led_pin_number_e ledNumber);
static void initButton(void);
static void initTouchSensor(void);
static void controlLED(led_pin_number_e ledNumber, UTIL_setReset_e setReset);
static UTIL_setReset_e getButtonState(void);
static UTIL_setReset_e getTouchedState(void);

int main(void)
{

	UTIL_lockUnlock_e lockState = UNLOCK;

	initLED(LED_1_PIN);
	initLED(LED_2_PIN);
	initLED(LED_3_PIN);

	initButton();

	initTouchSensor();

	lockState = GPIO_lockPort(TOUCH_SENSOR_PORT, 0x00000001U << TOUCH_SENSOR_PIN);

	controlLED(LED_1_PIN, SET);
	controlLED(LED_2_PIN, SET);
	controlLED(LED_3_PIN, SET);

	controlLED(LED_1_PIN, RESET);
	controlLED(LED_2_PIN, RESET);
	controlLED(LED_3_PIN, RESET);

	for(;;){
		controlLED(LED_3_PIN, getButtonState());
		controlLED(LED_2_PIN, getTouchedState());
	}

}

void EXTI0_IRQHandler(void){



}

static void initLED(led_pin_number_e ledNumber){

	GPIO_handle_s GPIO_handle;

	GPIO_handle.pBaseAddress 			= LED_PORT;
	GPIO_handle.config.pinNumber 		= ledNumber;
	GPIO_handle.config.pinMode 			= GPIO_OUTPUT;
	GPIO_handle.config.pinSpeed 		= GPIO_MEDIUM;
	GPIO_handle.config.pinPuPd 			= GPIO_NOPUPD;
	GPIO_handle.config.pinOutType 		= GPIO_PP;
	GPIO_handle.config.pinAltFuncMode 	= 0x00U;

	GPIO_clkCntrl(GPIO_handle.pBaseAddress, ENABLE);

	GPIO_init(&GPIO_handle);

}

static void initButton(void){

	GPIO_handle_s GPIO_handle;

	GPIO_handle.pBaseAddress 			= BUTTON_PORT;
	GPIO_handle.config.pinNumber 		= BUTTON_PIN;
	GPIO_handle.config.pinMode 			= GPIO_INPUT;
	GPIO_handle.config.pinSpeed 		= GPIO_MEDIUM;
	GPIO_handle.config.pinPuPd 			= GPIO_NOPUPD;
	GPIO_handle.config.pinOutType 		= GPIO_OD;
	GPIO_handle.config.pinAltFuncMode 	= 0x00U;

	GPIO_clkCntrl(GPIO_handle.pBaseAddress, ENABLE);

	GPIO_init(&GPIO_handle);

}

static void initTouchSensor(void){

	GPIO_handle_s GPIO_handle;

	GPIO_handle.pBaseAddress 			= TOUCH_SENSOR_PORT;
	GPIO_handle.config.pinNumber 		= TOUCH_SENSOR_PIN;
	GPIO_handle.config.pinMode 			= GPIO_INPUT;
	GPIO_handle.config.pinSpeed 		= GPIO_MEDIUM;
	GPIO_handle.config.pinPuPd 			= GPIO_NOPUPD;
	GPIO_handle.config.pinOutType 		= GPIO_OD;
	GPIO_handle.config.pinAltFuncMode 	= 0x00U;

	GPIO_clkCntrl(GPIO_handle.pBaseAddress, ENABLE);

	GPIO_init(&GPIO_handle);

}

static void controlLED(led_pin_number_e ledNumber, UTIL_setReset_e setReset){

	GPIO_writePin(LED_PORT, ledNumber, setReset);

}

static UTIL_setReset_e getButtonState(void){

	return GPIO_readPin(BUTTON_PORT, BUTTON_PIN);

}

static UTIL_setReset_e getTouchedState(void){

	return GPIO_readPin(TOUCH_SENSOR_PORT, TOUCH_SENSOR_PIN);

}
